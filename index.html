<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Flashcards App</title>
  <!-- Bootstrap CSS desde CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome para √≠conos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  
<!-- Aseg√∫rate de incluir en tu <head> la fuente Roboto -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&display=swap" rel="stylesheet">

<style>
  /* =========================
     Variables y reset
     ========================= */
  :root {
    --primary-color: #343a40;
    --accent-color: #007bff;
    --light-bg: #f4f7f6;
    --card-bg: #ffffff;
    --card-shadow: rgba(0, 0, 0, 0.1);
    --font-family: 'Roboto', sans-serif;
  }
  
  /* =========================
     Globales
     ========================= */
  body {
    background-color: var(--light-bg);
    margin: 0;
    padding: 0;
    font-family: var(--font-family);
    color: var(--primary-color);
  }
  
  /* =========================
     Navegaci√≥n
     ========================= */
  .navbar-custom {
    background-color: var(--primary-color);
    box-shadow: 0 2px 4px var(--card-shadow);
  }
  .navbar-custom .navbar-brand,
  .navbar-custom .nav-link {
    color: #fff;
  }
  
  /* =========================
     Utilidades
     ========================= */
  .hidden {
    display: none;
  }
  .container-section {
    padding: 20px;
  }
  
  /* =========================
     Flashcards (modo estudio y repaso)
     ========================= */
  .flashcard-container {
    position: relative;
    margin: 20px auto;
    width: 90%;
    max-width: 600px;
    height: 300px;
    background-color: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 4px 12px var(--card-shadow);
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    cursor: pointer;
    overflow: hidden;
    transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
  }
  .flashcard-container:hover {
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
  }
  .flashcard-content {
    padding: 20px;
    text-align: center;
    font-size: 1.5em;
    line-height: 1.4;
  }
  
  /* √çconos flotantes en la flashcard (verticalmente centrados a la derecha) */
  .flashcard-icons {
    position: absolute;
    top: 50%;
    right: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 10;
    transform: translateY(-50%);
  }
  .flashcard-icons i {
    font-size: 2.5em;
    cursor: pointer;
    color: var(--primary-color);
    transition: color 0.3s, transform 0.3s;
  }
  .flashcard-icons i:hover {
    color: var(--accent-color);
    transform: scale(1.1);
  }
  
  /* Modo noche */
  .night-mode {
    background-color: var(--primary-color) !important;
    color: #fff !important;
  }
  .night-mode .flashcard-icons i {
    color: #fff !important;
  }
  
  /* Bot√≥n de regresar */
  .back-button {
    position: absolute;
    top: 15px;
    left: 15px;
    font-size: 1.8em;
    cursor: pointer;
    color: var(--primary-color);
    z-index: 10;
    transition: color 0.3s;
  }
  .back-button:hover {
    color: var(--accent-color);
  }
  
  /* =========================
     Responsividad
     ========================= */
  @media (max-width: 768px) {
    .flashcard-container {
      height: 250px;
    }
    .flashcard-content {
      font-size: 1.2em;
    }
  }
  

/* =========================
   üìÖ Calendario Moderno sin Contenedor de Sesiones Planificadas
   ========================= */
#calendar {
  max-width: 800px;
  margin: 20px auto;
  background: transparent; /* Eliminamos cualquier fondo */
  border-radius: 0; /* Quitamos bordes */
  box-shadow: none; /* Eliminamos sombras para que no haya contorno */
  padding: 0; /* Eliminamos padding para que las sesiones se muestren directamente */
  overflow: visible;
}

/* üü¢ Cabecera del Calendario */
#calendar .fc-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #2d3748;
  color: white;
  padding: 12px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 8px;
}

/* üîµ Botones de navegaci√≥n */
#calendar .fc-button {
  background: #3182ce;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 6px 12px;
  font-size: 14px;
  font-weight: 600;
  transition: background 0.3s ease-in-out;
}

#calendar .fc-button:hover {
  background: #2b6cb0;
}

/* üìÜ D√≠as de la semana */
#calendar .fc-day-header {
  background: #f1f1f1;
  padding: 8px;
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  color: #2d3748;
  border-bottom: 2px solid #3182ce;
}

/* üìÖ Celdas de los d√≠as */
#calendar .fc-daygrid-day {
  padding: 10px;
  transition: background 0.2s ease-in-out;
  color: #2d3748;
  font-weight: 500;
}

#calendar .fc-daygrid-day:hover {
  background: rgba(49, 130, 206, 0.1);
  cursor: pointer;
}

/* üî¥ Eventos (Sesiones Planificadas) - SIN CONTENEDOR */
#calendar .fc-event {
  background: none !important; /* Eliminamos cualquier fondo */
  color: #2d3748 !important; /* Texto oscuro para que sea legible */
  font-size: 14px;
  font-weight: bold;
  text-align: left;
  padding: 0px 0; /* Eliminamos padding interno */
  border-radius: 0 !important; /* Quitamos esquinas redondeadas */
  border: none !important;
  box-shadow: none !important;
}

/* üì± Responsividad */
@media (max-width: 768px) {
  #calendar {
    max-width: 100%;
  }

  #calendar .fc-toolbar {
    flex-direction: column;
    gap: 10px;
  }

  #calendar .fc-button {
    padding: 5px 10px;
    font-size: 12px;
  }
}


</style>
</head>
<body>
  <!-- =============================
       Navegaci√≥n (Men√∫ Principal)
       ============================= -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container-fluid">
      <a class="navbar-brand" href="#" id="nav-home">Flashcards App</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="#" id="menu-creacion">Crear Flashcards</a>
          <a class="nav-link" href="#" id="menu-estudio">Estudiar</a>
          <a class="nav-link" href="#" id="menu-repaso">Repasar</a>
          <a class="nav-link" href="#" id="menu-calendario">Planificar Sesiones</a>
        </div>
      </div>
    </div>
  </nav>
  
  <!-- =============================
       Contenedor principal de vistas
       ============================= -->
  <div class="container-section" id="main-content">
  
    <!-- MODO CREACI√ìN -->
    <div id="section-creacion" class="hidden">
      <h2>Crear Flashcards</h2>
      <!-- Formulario para crear un bloque nuevo -->
      <div class="mb-3">
        <label for="input-nuevo-asignatura" class="form-label">Asignatura</label>
        <input type="text" class="form-control" id="input-nuevo-asignatura" placeholder="Ej. Matem√°ticas">
      </div>
      <div class="mb-3">
        <label for="input-nuevo-tema" class="form-label">Tema</label>
        <input type="text" class="form-control" id="input-nuevo-tema" placeholder="Ej. √Ålgebra">
      </div>
      <div class="mb-3">
        <label for="input-flashcards" class="form-label">Flashcards (formato: l√≠nea 1 = pregunta, l√≠nea 2 = respuesta, etc.)</label>
        <textarea class="form-control" id="input-flashcards" rows="8" placeholder="Flashcard pregunta 1
Flashcards respuesta 1
Flashcard pregunta 2
Flashcards respuesta 2"></textarea>
      </div>
      <button class="btn btn-primary" id="btn-guardar-flashcards">Guardar Flashcards</button>
      <hr>
      <!-- Secci√≥n para agregar flashcards a un bloque ya existente -->
      <h4>Agregar a bloque existente</h4>
      <div class="mb-3">
        <label for="select-asignatura-existente" class="form-label">Asignatura</label>
        <select class="form-select" id="select-asignatura-existente">
          <option value="">Selecciona una asignatura</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="select-tema-existente" class="form-label">Tema</label>
        <select class="form-select" id="select-tema-existente">
          <option value="">Selecciona un tema</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="input-flashcards-agregar" class="form-label">Flashcards (mismo formato)</label>
        <textarea class="form-control" id="input-flashcards-agregar" rows="8"></textarea>
      </div>
      <button class="btn btn-secondary" id="btn-agregar-flashcards">Agregar Flashcards al bloque existente</button>
    </div>
    
    <!-- MODO ESTUDIO -->
    <div id="section-estudio" class="hidden">
      <h2>Estudio de Flashcards</h2>
      <!-- Selecci√≥n de asignatura y tema -->
      <div id="estudio-seleccion">
        <div id="estudio-asignaturas" class="mb-3">
          <h4>Selecciona Asignatura</h4>
          <ul class="list-group" id="lista-asignaturas-estudio"></ul>
        </div>
        <div id="estudio-temas" class="mb-3 hidden">
          <button class="btn btn-link" id="btn-volver-asignaturas-estudio"><i class="fa fa-arrow-left"></i> Volver a Asignaturas</button>
          <h4>Selecciona Tema</h4>
          <ul class="list-group" id="lista-temas-estudio"></ul>
        </div>
      </div>
      <!-- √Årea de flashcards en modo estudio -->
      <div id="estudio-flashcards" class="hidden">
        <button class="btn btn-link" id="btn-volver-temas-estudio"><i class="fa fa-arrow-left"></i> Volver a Temas</button>
        <div class="flashcard-container" id="flashcard-container">
          <!-- Bot√≥n para salir del modo flashcards -->
          <div class="back-button" id="btn-salir-flashcards"><i class="fa fa-times"></i></div>
          <!-- √çconos flotantes para modo noche y clasificaci√≥n -->
          <div class="flashcard-icons">
            <i class="fa fa-sun" id="icon-noche" title="Modo Noche"></i>
            <i class="fa fa-smile" id="icon-facil" title="F√°cil"></i>
            <i class="fa fa-meh" id="icon-medio" title="Medio"></i>
            <i class="fa fa-frown" id="icon-dificil" title="Dif√≠cil"></i>
          </div>
          <div class="flashcard-content" id="flashcard-content">
            <!-- Aqu√≠ se mostrar√° el contenido de la flashcard -->
          </div>
        </div>
        <!-- Bot√≥n para pantalla completa (F11) -->
        <button class="btn btn-outline-primary" id="btn-fullscreen">Pantalla Completa</button>
      </div>
    </div>
    



    <!-- MODO REPASO -->
    <div id="section-repaso" class="hidden">
      <h2>Repaso de Flashcards</h2>
      <!-- Selecci√≥n de asignatura, tema y dificultad (se muestran solo opciones disponibles) -->
      <div id="repaso-seleccion">
        <div id="repaso-asignaturas" class="mb-3">
          <h4>Selecciona Asignatura</h4>
          <ul class="list-group" id="lista-asignaturas-repaso"></ul>
        </div>
        <div id="repaso-temas" class="mb-3 hidden">
          <button class="btn btn-link" id="btn-volver-asignaturas-repaso"><i class="fa fa-arrow-left"></i> Volver a Asignaturas</button>
          <h4>Selecciona Tema</h4>
          <ul class="list-group" id="lista-temas-repaso"></ul>
        </div>
        <div id="repaso-dificultad" class="mb-3 hidden">
          <button class="btn btn-link" id="btn-volver-temas-repaso"><i class="fa fa-arrow-left"></i> Volver a Temas</button>
          <h4>Selecciona Dificultad</h4>
          <ul class="list-group" id="lista-dificultad-repaso">
            <li class="list-group-item" data-difficulty="f√°cil">F√°cil</li>
            <li class="list-group-item" data-difficulty="medio">Medio</li>
            <li class="list-group-item" data-difficulty="dif√≠cil">Dif√≠cil</li>
          </ul>
        </div>
      </div>
      <!-- √Årea de flashcards en modo repaso -->
      <div id="repaso-flashcards" class="hidden">
        <button class="btn btn-link" id="btn-volver-dificultad-repaso"><i class="fa fa-arrow-left"></i> Volver a Dificultad</button>
        <div class="flashcard-container" id="flashcard-container-repaso">
          <div class="back-button" id="btn-salir-flashcards-repaso"><i class="fa fa-times"></i></div>
          <div class="flashcard-icons">
            <i class="fa fa-sun" id="icon-noche-repaso" title="Modo Noche"></i>
            <i class="fa fa-smile" id="icon-facil-repaso" title="F√°cil"></i>
            <i class="fa fa-meh" id="icon-medio-repaso" title="Medio"></i>
            <i class="fa fa-frown" id="icon-dificil-repaso" title="Dif√≠cil"></i>
          </div>
          <div class="flashcard-content" id="flashcard-content-repaso">
            <!-- Contenido de la flashcard de repaso -->
          </div>
        </div>
        <button class="btn btn-outline-primary" id="btn-fullscreen-repaso">Pantalla Completa</button>
      </div>
    </div>
    
    <!-- MODO CALENDARIO -->
    <div id="section-calendario" class="hidden">
      <h2>Planificar Sesiones de Repaso</h2>
      <div class="row">
        <div class="col-md-4">
          <h4>Crear Sesi√≥n</h4>
          <div class="mb-3">
            <label for="input-sesion-asignatura" class="form-label">Asignatura</label>
            <!-- Se llena con asignaturas que tengan flashcards clasificadas (disponibles para repaso) -->
            <select class="form-select" id="input-sesion-asignatura">
              <option value="">Selecciona una asignatura</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="input-sesion-tema" class="form-label">Tema</label>
            <!-- Se llenar√° con solo aquellos temas disponibles para repaso -->
            <select class="form-select" id="input-sesion-tema">
              <option value="">Selecciona un tema</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="input-sesion-dificultad" class="form-label">Dificultad</label>
            <select class="form-select" id="input-sesion-dificultad">
              <option value="">Selecciona dificultad</option>
              <option value="f√°cil">F√°cil</option>
              <option value="medio">Medio</option>
              <option value="dif√≠cil">Dif√≠cil</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="input-sesion-fecha" class="form-label">Fecha y Hora</label>
            <input type="datetime-local" class="form-control" id="input-sesion-fecha">
          </div>
          <button class="btn btn-primary" id="btn-crear-sesion">Crear Sesi√≥n</button>
        </div>
        <div class="col-md-8">
          <h4>Calendario de Sesiones</h4>
          <div id="calendar"></div>
        </div>
      </div>
    </div>
    
  </div>
  
  <!-- =============================
       Librer√≠as JavaScript
       ============================= -->
  <!-- Bootstrap Bundle (incluye Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  
  <script>
  /***********************************************
   * FLASHCARDS APP - L√≥gica y Manejo de Datos
   ***********************************************/
  
  // Objeto principal de la aplicaci√≥n con datos, sesiones y estado
  const app = {
    data: {
      // Estructura: { "Asignatura": { themes: { "Tema": [flashcard, ...] } } }
      subjects: {}
    },
    sessions: [], // Sesiones de repaso planificadas
    state: {
      currentMode: null,  // 'creacion', 'estudio', 'repaso', 'calendario'
      selectedSubject: null,
      selectedTheme: null,
      selectedDifficulty: null,
      flashcards: [],
      currentCardIndex: 0,
      nightMode: false
    }
  };
  
  // Funci√≥n para generar un ID √∫nico
  function generateId() {
    return '_' + Math.random().toString(36).substr(2, 9);
  }
  
  // Cargar datos y sesiones desde LocalStorage
  function loadData() {
    const storedData = localStorage.getItem('flashcardsData');
    if (storedData) {
      app.data = JSON.parse(storedData);
    }
    const storedSessions = localStorage.getItem('flashcardSessions');
    if (storedSessions) {
      app.sessions = JSON.parse(storedSessions);
    }
  }
  
  // Guardar datos y sesiones en LocalStorage
  function saveData() {
    localStorage.setItem('flashcardsData', JSON.stringify(app.data));
    localStorage.setItem('flashcardSessions', JSON.stringify(app.sessions));
  }
  
  // Mostrar solo la secci√≥n indicada y ocultar las dem√°s
  function showSection(sectionId) {
    const sections = ['section-creacion', 'section-estudio', 'section-repaso', 'section-calendario'];
    sections.forEach(id => {
      document.getElementById(id).classList.add('hidden');
    });
    document.getElementById(sectionId).classList.remove('hidden');
    // Actualiza el modo actual
    if(sectionId === 'section-creacion') app.state.currentMode = 'creacion';
    else if(sectionId === 'section-estudio') app.state.currentMode = 'estudio';
    else if(sectionId === 'section-repaso') app.state.currentMode = 'repaso';
    else if(sectionId === 'section-calendario') app.state.currentMode = 'calendario';
  }
  // Renderizar asignaturas en los dropdowns (para creaci√≥n y agregar)
function renderAsignaturasDropdowns() {
  const asignaturasSelects = ['select-asignatura-existente'];
  asignaturasSelects.forEach(selectId => {
    const selectElem = document.getElementById(selectId);
    if (!selectElem) return; // Evita errores si el elemento no est√° presente en el DOM
    selectElem.innerHTML = '<option value="">Selecciona una asignatura</option>';
    if (app.data && app.data.subjects) {
      Object.keys(app.data.subjects).forEach(subject => {
        const option = document.createElement('option');
        option.value = subject;
        option.textContent = subject;
        selectElem.appendChild(option);
      });
    }
  });
}

// Llamada a la funci√≥n tras definirla
document.addEventListener('DOMContentLoaded', () => {
  renderAsignaturasDropdowns();
});

  // Inicializaci√≥n de la aplicaci√≥n
  function init() {
    loadData();
    bindNavEvents();
    renderAsignaturasDropdowns(); // Para secciones que usan todas las asignaturas (creaci√≥n, agregar)
    // Por defecto se muestra el modo creaci√≥n
    showSection('section-creacion');
  }
  
  // Enlazar eventos del men√∫ de navegaci√≥n
  function bindNavEvents() {
    document.getElementById('menu-creacion').addEventListener('click', () => {
      showSection('section-creacion');
      renderAsignaturasDropdowns();
    });
    document.getElementById('menu-estudio').addEventListener('click', () => {
      showSection('section-estudio');
      renderEstudioAsignaturas();
    });
    document.getElementById('menu-repaso').addEventListener('click', () => {
      showSection('section-repaso');
      renderRepasoAsignaturas();
    });
    // En la secci√≥n de calendario usamos dropdowns sincronizados con las asignaturas/temas disponibles en repaso
    document.getElementById('menu-calendario').addEventListener('click', () => {
      showSection('section-calendario');
      renderCalendario();
      renderCalendarSubjectsDropdown();
    });
    document.getElementById('nav-home').addEventListener('click', () => {
      showSection('section-creacion');
      renderAsignaturasDropdowns();
    });
  }
  
  /***********************
   * MODO CREACI√ìN
   ***********************/
function showNotification(message, { background = 'var(--noti-bg)', color = 'var(--noti-text)', duration = 3000 } = {}) {
  // Crear la notificaci√≥n
  const notification = Object.assign(document.createElement('div'), { 
    textContent: message, 
    style: `
      position: fixed; top: 20px; right: 20px; padding: 14px 20px;
      font-size: 16px; font-family: inherit; font-weight: 600;
      background: ${background}; color: ${color}; border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); 
      z-index: 99999999; text-align: center; white-space: nowrap;
      opacity: 0; transform: translateY(-20px);
      transition: opacity 0.3s ease-out, transform 1.3s ease-out;
      pointer-events: none; max-width: 350px;
    `
  });

  // Animaci√≥n de entrada
  requestAnimationFrame(() => {
    notification.style.opacity = '1';
    notification.style.transform = 'translateY(0)';
  });

  // Verificar si la pantalla est√° en modo completo y a√±adir al elemento adecuado
  const targetContainer = document.fullscreenElement || document.documentElement;
  targetContainer.appendChild(notification);

  // Animaci√≥n de salida
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateY(-20px)';
  }, duration);

  notification.addEventListener('transitionend', () => notification.remove(), { once: true });
}

// Estilos CSS adaptables (Modo Claro y Oscuro)
const style = document.createElement('style');
style.textContent = `
  :root {
    --noti-bg: #2a2a2a;
    --noti-text: #ffffff;
  }
  
  [data-theme="light"] {
    --noti-bg: #ffffff;
    --noti-text: #333333;
  }

  [data-theme="dark"] {
    --noti-bg: #1e1e1e;
    --noti-text: #f1f1f1;
  }
`;
document.head.appendChild(style);

    
  // Guardar un nuevo bloque de flashcards
  document.getElementById('btn-guardar-flashcards').addEventListener('click', () => {
    const subject = document.getElementById('input-nuevo-asignatura').value.trim();
    const theme = document.getElementById('input-nuevo-tema').value.trim();
    const text = document.getElementById('input-flashcards').value.trim();
    if (!subject || !theme || !text) {
      showNotification('Por favor, complete todos los campos.');
      return;
    }
    // Crear la estructura en caso de que no exista
    if (!app.data.subjects[subject]) {
      app.data.subjects[subject] = { themes: {} };
    }
    if (!app.data.subjects[subject].themes[theme]) {
      app.data.subjects[subject].themes[theme] = [];
    }
    // Parsear el textarea (cada 2 l√≠neas = pregunta y respuesta)
    const lines = text.split('\n').filter(line => line.trim() !== '');
    for (let i = 0; i < lines.length; i += 2) {
      const question = lines[i];
      const answer = lines[i+1] || '';
      const flashcard = {
        id: generateId(),
        question: question,
        answer: answer,
        difficulty: null
      };
      app.data.subjects[subject].themes[theme].push(flashcard);
    }
    saveData();
    showNotification('Flashcards guardadas correctamente.');
    // Limpiar campos
    document.getElementById('input-nuevo-asignatura').value = '';
    document.getElementById('input-nuevo-tema').value = '';
    document.getElementById('input-flashcards').value = '';
    renderAsignaturasDropdowns();
  });
  
// Renderizar asignaturas en los dropdowns (para creaci√≥n y agregar)
function renderAsignaturasDropdowns() {
  const asignaturasSelects = ['select-asignatura-existente'];
  asignaturasSelects.forEach(selectId => {
    const selectElem = document.getElementById(selectId);
    selectElem.innerHTML = '<option value="">Selecciona una asignatura</option>';
    Object.keys(app.data.subjects).forEach(subject => {
      const option = document.createElement('option');
      option.value = subject;
      option.textContent = subject;
      selectElem.appendChild(option);
    });
  });
}

// Actualizar los temas en el dropdown cuando se selecciona una asignatura en "Agregar a bloque existente"
document.getElementById('select-asignatura-existente').addEventListener('change', (e) => {
  const subject = e.target.value;
  const temasSelect = document.getElementById('select-tema-existente');
  temasSelect.innerHTML = '<option value="">Selecciona un tema</option>';
  if (subject && app.data.subjects[subject]) {
    Object.keys(app.data.subjects[subject].themes).forEach(theme => {
      const option = document.createElement('option');
      option.value = theme;
      option.textContent = theme;
      temasSelect.appendChild(option);
    });
  }
});

// Agregar flashcards a un bloque existente
document.getElementById('btn-agregar-flashcards').addEventListener('click', () => {
  const subject = document.getElementById('select-asignatura-existente').value;
  const theme = document.getElementById('select-tema-existente').value;
  const text = document.getElementById('input-flashcards-agregar').value.trim();
  if (!subject || !theme || !text) {
    showNotification('Por favor, complete todos los campos para agregar flashcards.');
    return;
  }
  if (!app.data.subjects[subject] || !app.data.subjects[subject].themes[theme]) {
    alert('El bloque seleccionado no existe.');
    return;
  }
  const lines = text.split('\n').filter(line => line.trim() !== '');
  for (let i = 0; i < lines.length; i += 2) {
    const question = lines[i];
    const answer = lines[i+1] || '';
    const flashcard = {
      id: generateId(),
      question: question,
      answer: answer,
      difficulty: null
    };
    app.data.subjects[subject].themes[theme].push(flashcard);
  }
  saveData();
  alert('Flashcards agregadas correctamente.');
  document.getElementById('input-flashcards-agregar').value = '';
});

  /***********************
   * FUNCIONES PARA CALENDARIO (PLANIFICACI√ìN)
   ***********************/
  
  // Renderizar en el dropdown de la secci√≥n de calendario solo las asignaturas que tienen flashcards clasificadas
  function renderCalendarSubjectsDropdown() {
    const selectElem = document.getElementById('input-sesion-asignatura');
    selectElem.innerHTML = '<option value="">Selecciona una asignatura</option>';
    Object.keys(app.data.subjects).forEach(subject => {
      let hasClassified = false;
if (app.data.subjects[subject] && app.data.subjects[subject].themes) {
  Object.keys(app.data.subjects[subject].themes).forEach(theme => {
    if (Array.isArray(app.data.subjects[subject].themes[theme]) &&
        app.data.subjects[subject].themes[theme].some(fc => fc.difficulty !== null)) {
      hasClassified = true;
    }
  });
}

      if(hasClassified) {
        const option = document.createElement('option');
        option.value = subject;
        option.textContent = subject;
        selectElem.appendChild(option);
      }
    });
  }
  
  // Actualizar los temas en el formulario de sesi√≥n (modo calendario), filtrando solo aquellos disponibles para repaso
  document.getElementById('input-sesion-asignatura').addEventListener('change', (e) => {
    const subject = e.target.value;
    const temasSelect = document.getElementById('input-sesion-tema');
    temasSelect.innerHTML = '<option value="">Selecciona un tema</option>';
    if (subject && app.data.subjects[subject]) {
      Object.keys(app.data.subjects[subject].themes).forEach(theme => {
        if(app.data.subjects[subject].themes[theme].some(fc => fc.difficulty !== null)) {
          const option = document.createElement('option');
          option.value = theme;
          option.textContent = theme;
          temasSelect.appendChild(option);
        }
      });
    }
  });
  
  /***********************
   * MODO ESTUDIO
   ***********************/
  
  // Renderizar la lista de asignaturas para estudio
  function renderEstudioAsignaturas() {
    const lista = document.getElementById('lista-asignaturas-estudio');
    lista.innerHTML = '';
    Object.keys(app.data.subjects).forEach(subject => {
      const li = document.createElement('li');
      li.className = 'list-group-item list-group-item-action';
      li.textContent = subject;
      li.addEventListener('click', () => {
        app.state.selectedSubject = subject;
        renderEstudioTemas(subject);
      });
      lista.appendChild(li);
    });
  }
  
  // Renderizar la lista de temas para la asignatura seleccionada en estudio
  function renderEstudioTemas(subject) {
    document.getElementById('estudio-asignaturas').classList.add('hidden');
    const temasDiv = document.getElementById('estudio-temas');
    temasDiv.classList.remove('hidden');
    const lista = document.getElementById('lista-temas-estudio');
    lista.innerHTML = '';
    Object.keys(app.data.subjects[subject].themes).forEach(theme => {
      const li = document.createElement('li');
      li.className = 'list-group-item list-group-item-action';
      li.textContent = theme;
      li.addEventListener('click', () => {
        app.state.selectedTheme = theme;
        app.state.flashcards = app.data.subjects[app.state.selectedSubject].themes[theme];
        app.state.currentCardIndex = 0;
        renderFlashcardEstudio();
      });
      lista.appendChild(li);
    });
  }
  
  // Bot√≥n para volver a la selecci√≥n de asignaturas en estudio
  document.getElementById('btn-volver-asignaturas-estudio').addEventListener('click', () => {
    document.getElementById('estudio-temas').classList.add('hidden');
    document.getElementById('estudio-asignaturas').classList.remove('hidden');
  });
  
  // Bot√≥n para volver a la selecci√≥n de temas desde el modo flashcards (estudio)
  document.getElementById('btn-volver-temas-estudio').addEventListener('click', () => {
    document.getElementById('estudio-flashcards').classList.add('hidden');
    document.getElementById('estudio-temas').classList.remove('hidden');
  });
  
  // Bot√≥n para salir del modo flashcards en estudio
  document.getElementById('btn-salir-flashcards').addEventListener('click', () => {
    document.getElementById('estudio-flashcards').classList.add('hidden');
    document.getElementById('estudio-temas').classList.remove('hidden');
  });
  
  // Renderizar la flashcard actual en modo estudio
  function renderFlashcardEstudio() {
    if (app.state.flashcards.length === 0) {
      showNotification('No hay flashcards en este tema.');
      return;
    }
    document.getElementById('estudio-temas').classList.add('hidden');
    document.getElementById('estudio-flashcards').classList.remove('hidden');
    updateFlashcardContent('question');
  }
  
  // Actualizar el contenido (pregunta/respuesta) de la flashcard en estudio
  // face: 'question' o 'answer'
  function updateFlashcardContent(face) {
    const container = document.getElementById('flashcard-container');
    const contentDiv = document.getElementById('flashcard-content');
    const currentFlashcard = app.state.flashcards[app.state.currentCardIndex];
    if (!currentFlashcard) return;
    contentDiv.textContent = currentFlashcard[face];
    container.setAttribute('data-face', face);
  }
  


/***********************
 * MODO REPASO
 ***********************/

// Renderizar asignaturas para repaso (solo aquellas con flashcards clasificadas)
function renderRepasoAsignaturas() {
    const lista = document.getElementById('lista-asignaturas-repaso');
    lista.innerHTML = '';
    let hayAsignaturas = false;

    Object.keys(app.data.subjects).forEach(subject => {
        const themes = app.data.subjects[subject].themes;
        let subjectTieneClasificadas = false;
        if (themes && typeof themes === 'object') {
            Object.keys(themes).forEach(theme => {
                if (Array.isArray(themes[theme]) && themes[theme].some(fc => fc.difficulty !== null)) {
                    subjectTieneClasificadas = true;
                }
            });
        }

        if (subjectTieneClasificadas) {
            hayAsignaturas = true;
            const li = document.createElement('li');
            li.className = 'list-group-item list-group-item-action';
            li.textContent = subject;
            li.addEventListener('click', () => {
                app.state.selectedSubject = subject;
                renderRepasoTemas(subject);
            });
            lista.appendChild(li);
        }
    });

    if (!hayAsignaturas) {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = 'No hay flashcards clasificadas para repaso';
        lista.appendChild(li);
    }
}

// Renderizar temas para repaso (solo aquellos con flashcards clasificadas)
function renderRepasoTemas(subject) {
    document.getElementById('repaso-asignaturas').classList.add('hidden');
    const temasDiv = document.getElementById('repaso-temas');
    temasDiv.classList.remove('hidden');
    const lista = document.getElementById('lista-temas-repaso');
    lista.innerHTML = '';
    let hayTemas = false;

    Object.keys(app.data.subjects[subject].themes).forEach(theme => {
        if (app.data.subjects[subject].themes[theme].some(fc => fc.difficulty !== null)) {
            hayTemas = true;
            const li = document.createElement('li');
            li.className = 'list-group-item list-group-item-action';
            li.textContent = theme;
            li.addEventListener('click', () => {
                app.state.selectedTheme = theme;
                // Mostrar selecci√≥n de dificultad en repaso
                document.getElementById('repaso-dificultad').classList.remove('hidden');
            });
            lista.appendChild(li);
        }
    });

    if (!hayTemas) {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = 'No hay flashcards clasificadas en este tema';
        lista.appendChild(li);
    }
}

// Botones para volver en repaso
document.getElementById('btn-volver-asignaturas-repaso').addEventListener('click', () => {
    document.getElementById('repaso-temas').classList.add('hidden');
    document.getElementById('repaso-asignaturas').classList.remove('hidden');
});

document.getElementById('btn-volver-temas-repaso').addEventListener('click', () => {
    document.getElementById('repaso-dificultad').classList.add('hidden');
    document.getElementById('repaso-temas').classList.remove('hidden');
});

document.getElementById('btn-volver-dificultad-repaso').addEventListener('click', () => {
    document.getElementById('repaso-flashcards').classList.add('hidden');
    document.getElementById('repaso-dificultad').classList.remove('hidden');
});

// Salir del modo repaso completamente y volver a la pantalla principal de asignaturas
document.getElementById('btn-salir-flashcards-repaso').addEventListener('click', () => {
    if (document.fullscreenElement) {
        document.exitFullscreen().then(() => {
            salirModoRepaso();
        }).catch(err => {
            console.warn(`Error al salir de pantalla completa: ${err.message}`);
            salirModoRepaso(); // Asegurar que se oculta correctamente
        });
    } else {
        salirModoRepaso();
    }
});

// Funci√≥n para salir del modo repaso
function salirModoRepaso() {
    document.getElementById('repaso-flashcards').classList.add('hidden');
    document.getElementById('repaso-asignaturas').classList.remove('hidden');
}

// Selecci√≥n de dificultad en repaso
document.getElementById('lista-dificultad-repaso').addEventListener('click', (e) => {
    if (e.target && e.target.matches('li')) {
        const difficulty = e.target.getAttribute('data-difficulty');
        app.state.selectedDifficulty = difficulty;
        const allFlashcards = app.data.subjects[app.state.selectedSubject].themes[app.state.selectedTheme];
        app.state.flashcards = allFlashcards.filter(fc => fc.difficulty === difficulty);
        app.state.currentCardIndex = 0;
        if (app.state.flashcards.length === 0) {
            showNotification('No hay flashcards con esa clasificaci√≥n.');
            return;
        }
        document.getElementById('repaso-dificultad').classList.add('hidden');
        document.getElementById('repaso-flashcards').classList.remove('hidden');
        updateFlashcardContentRepaso('question');
    }
});

// Actualizar el contenido de la flashcard en repaso
function updateFlashcardContentRepaso(face) {
    const container = document.getElementById('flashcard-container-repaso');
    const contentDiv = document.getElementById('flashcard-content-repaso');
    const currentFlashcard = app.state.flashcards[app.state.currentCardIndex];
    if (!currentFlashcard) return;
    contentDiv.textContent = currentFlashcard[face];
    container.setAttribute('data-face', face);
}
  

  
  // Botones de clasificaci√≥n en repaso
  document.getElementById('icon-facil-repaso').addEventListener('click', () => {
    setFlashcardDifficultyRepaso('f√°cil');
  });
  document.getElementById('icon-medio-repaso').addEventListener('click', () => {
    setFlashcardDifficultyRepaso('medio');
  });
  document.getElementById('icon-dificil-repaso').addEventListener('click', () => {
    setFlashcardDifficultyRepaso('dif√≠cil');
  });
  
  function setFlashcardDifficultyRepaso(level) {
    const currentFlashcard = app.state.flashcards[app.state.currentCardIndex];
    if(currentFlashcard) {
      currentFlashcard.difficulty = level;
      saveData();
      showNotification('Flashcard reclasificada como ' + level);
    }
  }
  
  // Modo noche en repaso
  document.getElementById('icon-noche-repaso').addEventListener('click', () => {
    toggleNightMode('repaso');
  });
  
  // Pantalla completa en repaso
  document.getElementById('btn-fullscreen-repaso').addEventListener('click', () => {
    toggleFullScreen(document.getElementById('flashcard-container-repaso'));
  });
  /********** GESTOS EN MODO ESTUDIO CON TRANSICIONES PERSONALIZADAS **********/

// Funci√≥n para animar la transici√≥n de la flashcard, simulando el paso de p√°ginas
function animateCardTransition(container, animationType, callback) {
  let keyframesOut, keyframesIn;
  // Usamos un timing similar a scroll personalizado
  const timing = { duration: 400, easing: 'cubic-bezier(0.25, 0.1, 0.25, 1)', fill: 'forwards' };

  if (animationType === 'flip') {
    // Efecto de "pasar p√°gina" al cambiar de cara:
    keyframesOut = [
      { transform: 'translateY(0)', opacity: 1 },
      { transform: 'translateY(-20px)', opacity: 0.5 }
    ];
    keyframesIn = [
      { transform: 'translateY(20px)', opacity: 0.5 },
      { transform: 'translateY(0)', opacity: 1 }
    ];
  } else if (animationType === 'next') {
    keyframesOut = [
      { transform: 'translateY(0)', opacity: 1 },
      { transform: 'translateY(-100%)', opacity: 0 }
    ];
    keyframesIn = [
      { transform: 'translateY(100%)', opacity: 0 },
      { transform: 'translateY(0)', opacity: 1 }
    ];
  } else if (animationType === 'prev') {
    keyframesOut = [
      { transform: 'translateY(0)', opacity: 1 },
      { transform: 'translateY(100%)', opacity: 0 }
    ];
    keyframesIn = [
      { transform: 'translateY(-100%)', opacity: 0 },
      { transform: 'translateY(0)', opacity: 1 }
    ];
  }

  container.animate(keyframesOut, timing).onfinish = () => {
    callback();
    container.animate(keyframesIn, timing);
  };
}

// GESTOS EN MODO ESTUDIO

// Para pantallas anchas (‚â• 1367px): usar clic en zonas verticales con animaci√≥n
document.getElementById('flashcard-container').addEventListener('click', (e) => {
  if (window.innerWidth >= 1367) {
    const container = e.currentTarget;
    const rect = container.getBoundingClientRect();
    const y = e.clientY - rect.top;
    const face = container.getAttribute('data-face') || 'question';
    if (y < rect.height / 3) {
      // Zona superior: flashcard anterior (si existe)
      if (app.state.currentCardIndex > 0) {
        animateCardTransition(container, 'prev', () => {
          app.state.currentCardIndex--;
          updateFlashcardContent('question');
        });
      }
    } else if (y < 2 * rect.height / 3) {
      // Zona central: alternar cara con efecto flip
      animateCardTransition(container, 'flip', () => {
        const newFace = (face === 'question') ? 'answer' : 'question';
        updateFlashcardContent(newFace);
      });
    } else {
      // Zona inferior: siguiente flashcard (si existe)
      if (app.state.currentCardIndex < app.state.flashcards.length - 1) {
        animateCardTransition(container, 'next', () => {
          app.state.currentCardIndex++;
          updateFlashcardContent('question');
        });
      }
    }
  }
});

// Para pantallas peque√±as (< 1367px): detectar arrastre (swipe) para alternar cara o pasar entre flashcards con animaci√≥n
document.getElementById('flashcard-container').addEventListener('touchstart', (e) => {
  if (window.innerWidth < 1367) {
    touchStartXEstudio = e.changedTouches[0].clientX;
    touchStartYEstudio = e.changedTouches[0].clientY;
  }
});
document.getElementById('flashcard-container').addEventListener('touchend', (e) => {
  if (window.innerWidth < 1367 && touchStartXEstudio !== null && touchStartYEstudio !== null) {
    const container = document.getElementById('flashcard-container');
    const touchEndX = e.changedTouches[0].clientX;
    const touchEndY = e.changedTouches[0].clientY;
    const dx = touchEndX - touchStartXEstudio;
    const dy = touchEndY - touchStartYEstudio;
    if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50) {
      // Arrastre horizontal: alternar cara
      animateCardTransition(container, 'flip', () => {
        const face = container.getAttribute('data-face') || 'question';
        const newFace = (face === 'question') ? 'answer' : 'question';
        updateFlashcardContent(newFace);
      });
    } else if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > 50) {
      // Arrastre vertical: si dy negativo -> siguiente, si dy positivo -> anterior
      if (dy < 0) {
        if (app.state.currentCardIndex < app.state.flashcards.length - 1) {
          animateCardTransition(container, 'next', () => {
            app.state.currentCardIndex++;
            updateFlashcardContent('question');
          });
        }
      } else {
        if (app.state.currentCardIndex > 0) {
          animateCardTransition(container, 'prev', () => {
            app.state.currentCardIndex--;
            updateFlashcardContent('question');
          });
        }
      }
    }
    touchStartXEstudio = null;
    touchStartYEstudio = null;
  }
});


// GESTOS EN MODO REPASO

// Para pantallas anchas (‚â• 1367px): usar clic en zonas verticales con animaci√≥n
document.getElementById('flashcard-container-repaso').addEventListener('click', (e) => {
  if (window.innerWidth >= 1367) {
    const container = e.currentTarget;
    const rect = container.getBoundingClientRect();
    const y = e.clientY - rect.top;
    const face = container.getAttribute('data-face') || 'question';
    if (y < rect.height / 3) {
      if (app.state.currentCardIndex > 0) {
        animateCardTransition(container, 'prev', () => {
          app.state.currentCardIndex--;
          updateFlashcardContentRepaso('question');
        });
      }
    } else if (y < 2 * rect.height / 3) {
      animateCardTransition(container, 'flip', () => {
        const newFace = (face === 'question') ? 'answer' : 'question';
        updateFlashcardContentRepaso(newFace);
      });
    } else {
      if (app.state.currentCardIndex < app.state.flashcards.length - 1) {
        animateCardTransition(container, 'next', () => {
          app.state.currentCardIndex++;
          updateFlashcardContentRepaso('question');
        });
      }
    }
  }
});

// Para pantallas peque√±as (< 1367px): detectar arrastre (swipe)
document.getElementById('flashcard-container-repaso').addEventListener('touchstart', (e) => {
  if (window.innerWidth < 1367) {
    touchStartXRepaso = e.changedTouches[0].clientX;
    touchStartYRepaso = e.changedTouches[0].clientY;
  }
});
document.getElementById('flashcard-container-repaso').addEventListener('touchend', (e) => {
  if (window.innerWidth < 1367 && touchStartXRepaso !== null && touchStartYRepaso !== null) {
    const container = document.getElementById('flashcard-container-repaso');
    const touchEndX = e.changedTouches[0].clientX;
    const touchEndY = e.changedTouches[0].clientY;
    const dx = touchEndX - touchStartXRepaso;
    const dy = touchEndY - touchStartYRepaso;
    if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50) {
      animateCardTransition(container, 'flip', () => {
        const face = container.getAttribute('data-face') || 'question';
        const newFace = (face === 'question') ? 'answer' : 'question';
        updateFlashcardContentRepaso(newFace);
      });
    } else if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > 50) {
      if (dy < 0) {
        if (app.state.currentCardIndex < app.state.flashcards.length - 1) {
          animateCardTransition(container, 'next', () => {
            app.state.currentCardIndex++;
            updateFlashcardContentRepaso('question');
          });
        }
      } else {
        if (app.state.currentCardIndex > 0) {
          animateCardTransition(container, 'prev', () => {
            app.state.currentCardIndex--;
            updateFlashcardContentRepaso('question');
          });
        }
      }
    }
    touchStartXRepaso = null;
    touchStartYRepaso = null;
  }
});

  /***********************
   * MODO CALENDARIO
   ***********************/
  
  // Crear sesi√≥n de repaso y guardarla en LocalStorage
  document.getElementById('btn-crear-sesion').addEventListener('click', () => {
    const subject = document.getElementById('input-sesion-asignatura').value;
    const theme = document.getElementById('input-sesion-tema').value;
    const difficulty = document.getElementById('input-sesion-dificultad').value;
    const datetime = document.getElementById('input-sesion-fecha').value;
    if(!subject || !theme || !difficulty || !datetime) {
      showNotification('Por favor, complete todos los campos para crear la sesi√≥n.');
      return;
    }
    const session = {
      id: generateId(),
      subject: subject,
      theme: theme,
      difficulty: difficulty,
      datetime: datetime
    };
    app.sessions.push(session);
    saveData();
    showNotification('Sesi√≥n creada correctamente.');
    // Reiniciar formulario
    document.getElementById('input-sesion-asignatura').value = '';
    document.getElementById('input-sesion-tema').innerHTML = '<option value="">Selecciona un tema</option>';
    document.getElementById('input-sesion-dificultad').value = '';
    document.getElementById('input-sesion-fecha').value = '';
    renderCalendario();
  });
  
  // Renderizar el calendario usando FullCalendar (o mostrar mensaje si no hay sesiones)
  function renderCalendario() {
    const calendarEl = document.getElementById('calendar');
    calendarEl.innerHTML = ''; // Limpiar contenido anterior
    if(app.sessions.length === 0){
      calendarEl.innerHTML = '<div class="text-center p-5">No hay sesiones planificadas</div>';
      return;
    }
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      height: 500,
      events: app.sessions.map(session => ({
        id: session.id,
        title: session.subject + ' - ' + session.theme + ' (' + session.difficulty + ')',
        start: session.datetime
      })),
      eventClick: function(info) {
        // Al hacer clic en un evento, redirige a repasar la clasificaci√≥n de la tem√°tica seleccionada.
        const sessionId = info.event.id;
        const session = app.sessions.find(s => s.id === sessionId);
        if(session) {
          showSection('section-repaso');
          app.state.selectedSubject = session.subject;
          app.state.selectedTheme = session.theme;
          app.state.selectedDifficulty = session.difficulty;
          const allFlashcards = app.data.subjects[session.subject].themes[session.theme];
          app.state.flashcards = allFlashcards.filter(fc => fc.difficulty === session.difficulty);
          app.state.currentCardIndex = 0;
          // Se ocultan las selecciones para ir directo al repaso
          document.getElementById('repaso-asignaturas').classList.add('hidden');
          document.getElementById('repaso-temas').classList.add('hidden');
          document.getElementById('repaso-dificultad').classList.add('hidden');
          document.getElementById('repaso-flashcards').classList.remove('hidden');
          updateFlashcardContentRepaso('question');
        }
      }
    });
    calendar.render();
  }
  
// Funci√≥n para alternar pantalla completa
function toggleFullScreen(element) {
    if (!document.fullscreenElement) {
        element.requestFullscreen().catch(err => {
            console.warn(`Error al intentar entrar en pantalla completa: ${err.message}`);
        });
    } else {
        document.exitFullscreen();
    }
}

// Bot√≥n para salir del modo flashcards en estudio
document.getElementById('btn-salir-flashcards').addEventListener('click', () => {
    if (document.fullscreenElement) {
        document.exitFullscreen().then(() => {
            salirModoFlashcards();
        }).catch(err => {
            console.warn(`Error al salir de pantalla completa: ${err.message}`);
            salirModoFlashcards(); // Asegurar que el modo flashcards se oculta
        });
    } else {
        salirModoFlashcards();
    }
});

// Funci√≥n para salir del modo flashcards
function salirModoFlashcards() {
    document.getElementById('estudio-flashcards').classList.add('hidden');
    document.getElementById('estudio-temas').classList.remove('hidden');
}
  
  document.addEventListener("fullscreenchange", function() {
    if (!document.fullscreenElement) {
      if(app.state.currentMode === 'estudio'){
         updateFlashcardContent('question');
      } else if(app.state.currentMode === 'repaso'){
         updateFlashcardContentRepaso('question');
      }
    }
  });
// Botones para clasificar la flashcard (modo estudio)
  document.getElementById('icon-facil').addEventListener('click', () => {
    setFlashcardDifficulty('f√°cil');
  });
  document.getElementById('icon-medio').addEventListener('click', () => {
    setFlashcardDifficulty('medio');
  });
  document.getElementById('icon-dificil').addEventListener('click', () => {
    setFlashcardDifficulty('dif√≠cil');
  });
  
  // Asignar dificultad a la flashcard actual y guardar en LocalStorage
  function setFlashcardDifficulty(level) {
    const currentFlashcard = app.state.flashcards[app.state.currentCardIndex];
    if(currentFlashcard) {
      currentFlashcard.difficulty = level;
      saveData();
      showNotification('Flashcard clasificada como ' + level);
    }
  }
  
  // Modo noche en estudio
  document.getElementById('icon-noche').addEventListener('click', () => {
    toggleNightMode('estudio');
  });
  
  // Pantalla completa en estudio
  document.getElementById('btn-fullscreen').addEventListener('click', () => {
    toggleFullScreen(document.getElementById('flashcard-container'));
  });  // Alternar modo noche: se aplica o remueve la clase 'night-mode'
  function toggleNightMode(mode) {
    if(mode === 'estudio') {
      const container = document.getElementById('flashcard-container');
      app.state.nightMode = !app.state.nightMode;
      container.classList.toggle('night-mode', app.state.nightMode);
    } else if(mode === 'repaso') {
      const container = document.getElementById('flashcard-container-repaso');
      app.state.nightMode = !app.state.nightMode;
      container.classList.toggle('night-mode', app.state.nightMode);
    }
  }
  
  // Inicializar la aplicaci√≥n al cargar el DOM
  document.addEventListener('DOMContentLoaded', init);
  
  </script>
</body>
</html>
